<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tracker Hub</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Minimal inline CSS to make the page usable immediately.
       Keep your main styles in style.css and remove these if duplicated. */
    :root{
      --bg:#0f1115;
      --card:#13151a;
      --muted:#9aa0a6;
      --accent:#7c3aed;
      --white:#fff;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--white);font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    .container{max-width:980px;margin:28px auto;padding:0 16px;}
    header.container{text-align:center;margin-bottom:18px;}
    header h1{margin:0;font-size:24px;letter-spacing:0.2px;}
    header p{margin:6px 0 0;color:var(--muted);}
    .home-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px;margin-top:22px;}
    .home-card{display:block;padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));text-decoration:none;color:inherit;box-shadow:0 6px 18px rgba(0,0,0,0.6);transition:transform .12s ease, box-shadow .12s;}
    .home-card:hover{transform:translateY(-4px);box-shadow:0 12px 28px rgba(0,0,0,0.7);}
    .home-card h2{margin:0 0 8px 0;font-size:18px;}
    .home-card p{margin:0;color:var(--muted);font-size:14px;}
    .topbar{display:flex;align-items:center;gap:12px;justify-content:flex-end;margin-top:12px;}
    .btn{appearance:none;border:0;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600;}
    .secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--white);}
    .accent{background:var(--accent);color:var(--white);}
    .ghost{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.03);}
    .hidden{display:none !important;}
    .center{text-align:center;}
    .muted{color:var(--muted);font-size:13px;}
    .user-info{display:flex;align-items:center;gap:8px;}
    .user-photo{width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid rgba(255,255,255,0.06);}
    .actions{display:flex;gap:8px;align-items:center;}
    footer.container{margin:30px auto 60px;color:var(--muted);font-size:13px;text-align:center;}
    @media (max-width:420px){
      header h1{font-size:20px;}
    }
  </style>
</head>
<body>
  <header class="container">
    <h1>Personal Tracker</h1>
    <p class="muted">Choose what you want to manage today.</p>

    <div class="topbar">
      <div id="auth-section" class="user-area">
        <button id="login-btn" class="btn secondary">Sign in with Google</button>
        <button id="skip-btn" class="btn ghost">Use without sign-in (Local-only)</button>

        <div id="user-info" class="user-info hidden" aria-live="polite">
          <img id="user-photo" class="user-photo" src="" alt="User photo" />
          <span id="user-name" class="muted"></span>
          <div class="actions">
            <button id="logout-btn" class="btn secondary">Logout</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container home-grid" id="links-grid">
    <a href="habit.html" id="link-habit" class="card home-card">
      <h2>Habit Tracker</h2>
      <p>Track your daily habits, streaks and weekly view.</p>
    </a>

    <a href="expense.html" id="link-expense" class="card home-card">
      <h2>Expense / Income Tracker</h2>
      <p>Track daily spending, income and monthly budget.</p>
    </a>
  </main>

  <footer class="container muted center">
    Data is stored locally (localStorage) unless you sign in — then it syncs with your Firebase account.
  </footer>

  <!-- Firebase Compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // ------------------------
    // FIREBASE CONFIG — replace here if you want to use a different project
    // ------------------------
    const firebaseConfig = {
      apiKey: "AIzaSyCc22Lttv8BEq4QSw_mrI_NwXJHackYD3w",
      authDomain: "personal-tracker-1f02e.firebaseapp.com",
      projectId: "personal-tracker-1f02e",
      storageBucket: "personal-tracker-1f02e.firebasestorage.app",
      messagingSenderId: "924625298797",
      appId: "1:924625298797:web:7c9c9e684b111c32762664"
    };

    // Initialize Firebase (compat)
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ------------------------
    // UI elements
    // ------------------------
    const loginBtn = document.getElementById('login-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const userInfo = document.getElementById('user-info');
    const userName = document.getElementById('user-name');
    const userPhoto = document.getElementById('user-photo');
    const skipBtn = document.getElementById('skip-btn');

    const linksGrid = document.getElementById('links-grid');
    const linkHabit = document.getElementById('link-habit');
    const linkExpense = document.getElementById('link-expense');

    let currentUser = null;
    let localOnly = false; // set true if user chose skip

    // ------------------------
    // Auth handlers
    // ------------------------
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        localOnly = false;
        loginBtn.classList.add('hidden');
        skipBtn.classList.add('hidden');
        userInfo.classList.remove('hidden');
        userName.textContent = user.displayName ?? user.email;
        userPhoto.src = user.photoURL ?? '';
        // Optionally: fetch user-specific data here or set a flag so habit/expense pages can load cloud data
        // Example: localStorage.setItem('userLoggedIn', JSON.stringify({uid: user.uid}));
      } else {
        currentUser = null;
        userInfo.classList.add('hidden');
        loginBtn.classList.remove('hidden');
        skipBtn.classList.remove('hidden');
        // If the user signed out and local-only wasn't chosen, we keep them local-only off.
        // clear any cloud-only flags:
        // localStorage.removeItem('userLoggedIn');
      }
    });

    loginBtn.addEventListener('click', async () => {
      try {
        // Google provider
        const provider = new firebase.auth.GoogleAuthProvider();
        await auth.signInWithPopup(provider);
        // onAuthStateChanged will handle UI update
      } catch (err) {
        console.error('Login error', err);
        alert('Login failed: ' + (err.message || err));
      }
    });

    logoutBtn.addEventListener('click', async () => {
      try {
        await auth.signOut();
        currentUser = null;
        userInfo.classList.add('hidden');
        loginBtn.classList.remove('hidden');
        skipBtn.classList.remove('hidden');
        // If needed, also refresh page or reset local flags
      } catch (err) {
        console.error('Logout error', err);
      }
    });

    // Skip login: use app locally only
    skipBtn.addEventListener('click', () => {
      if (!confirm('Continue without signing in? Your data will be stored locally only on this device.')) return;
      localOnly = true;
      loginBtn.classList.add('hidden');
      skipBtn.classList.add('hidden');
      // Show a subtle indicator in UI that user is local-only (optional)
      // You can store a flag for other pages to know
      localStorage.setItem('tracker_localOnly', '1');
    });

    // ------------------------
    // Prevent accidental cloud-only navigation:
    // If user is not signed-in AND not in localOnly mode, show a prompt asking to sign in.
    // This prevents people from opening habit/expense and expecting cloud-sync right away.
    // ------------------------
    function guardNavigation(e) {
      // Allow if already signed in or explicitly chose localOnly
      if (currentUser || localOnly) return true;

      e.preventDefault();
      const proceed = confirm('You are not signed in. Sign in to enable cloud sync.\n\nPress OK to sign in now, or Cancel to continue local-only.');
      if (proceed) {
        // open login flow
        loginBtn.click();
      } else {
        // set local-only and continue
        localOnly = true;
        localStorage.setItem('tracker_localOnly', '1');
        loginBtn.classList.add('hidden');
        skipBtn.classList.add('hidden');
        // now navigate
        window.location = e.currentTarget.href;
      }
      return false;
    }

    // Attach guards to links
    linkHabit.addEventListener('click', guardNavigation);
    linkExpense.addEventListener('click', guardNavigation);

    // If user previously chose local-only, respect that on load
    (function checkLocalOnlyFlag(){
      if (localStorage.getItem('tracker_localOnly') === '1') {
        localOnly = true;
        loginBtn.classList.add('hidden');
        skipBtn.classList.add('hidden');
      }
    })();

    // Accessibility: keyboard shortcut 'L' to open login (convenience)
    document.addEventListener('keydown', (ev) => {
      if (ev.key.toLowerCase() === 'l' && !currentUser && !localOnly) {
        loginBtn.click();
      }
    });
  </script>
</body>
</html>
